<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="mx.org.ift.simca.persistence.EstacionMapper">

<!--     <resultMap id="estacionMap" type="Estacion" > -->
<!--     	<id property="folioElectronico" column="FOLIO_ELECTRONICO" jdbcType="VARCHAR"/> -->
<!--     	<id property="idSenial" column="ID_SENIAL" jdbcType="INTEGER"/> -->
<!--         <id property="idClase" column="ID_CLASE" jdbcType="INTEGER"/> -->
<!--         <id property="idTipoUsoEstacion" column="ID_TIPO_USO_ESTACION" jdbcType="INTEGER"/> -->
<!--         <id property="distintivo" column="DISTINTIVO" jdbcType="VARCHAR"/> -->
<!--         <id property="idBanda" column="ID_BANDA" jdbcType="INTEGER"/> -->
<!--         <id property="idTipoFrecuencia" column="ID_TIPO_FRECUENCIA" jdbcType="INTEGER"/> -->
<!--         <id property="frecuencia" column="FRECUENCIA" jdbcType="INTEGER"/> -->
<!--         <id property="fecIniVigencia" column="FEC_INI_VIGENCIA" jdbcType="DATE"/> -->
<!--         <id property="fecFinVigencia" column="FEC_FIN_VIGENCIA" jdbcType="DATE"/> -->
<!--     </resultMap> -->
    
    <resultMap id="estacionMap" type="Estacion" >
    	<id property="distintivo" column="DISTINTIVO" jdbcType="VARCHAR"/>
    	<id property="poblacion" column="POBLACION" jdbcType="VARCHAR"/>
        <id property="estado" column="ESTADO" jdbcType="VARCHAR"/>
        <id property="tipoUsoEstacion" column="TIPO_USO_ESTACION" jdbcType="VARCHAR"/>
        <id property="concesionario" column="NOM_CONCESIONARIO" jdbcType="VARCHAR"/>
        <id property="banda" column="BANDA" jdbcType="VARCHAR"/>
        <id property="frecuencia" column="FRECUENCIA" jdbcType="INTEGER"/>
    </resultMap>

    <sql id="tableName">estacion</sql>

    <sql id="allColumns">
        FOLIO_ELECTRONICO, ID_SENIAL, ID_CLASE, ID_TIPO_USO_ESTACION, DISTINTIVO, ID_BANDA, ID_TIPO_FRECUENCIA, FRECUENCIA, FEC_INI_VIGENCIA, FEC_FIN_VIGENCIA
    </sql>
    
    <select id="getAll"
        parameterType="Estacion"
        resultMap="estacionMap">
        <include refid="selectColumnsFrom"/> 
    </select>
    
    <sql id="selectColumnsFrom">
        SELECT
            <include refid="allColumns"/>
        FROM <include refid="tableName"/>
    </sql>
    
    <sql id="searchColumns">
    	ETN.DISTINTIVO, POB.POBLACION, EST.ESTADO, TUE.TIPO_USO_ESTACION, CON.NOM_CONCESIONARIO, BAN.BANDA, ETN.FRECUENCIA
    </sql>
    
    <sql id="searchTableName">
    	ESTACION ETN, COBERTURA_RADIO CRD, ESTADO EST, POBLACION POB, TIPO_USO_ESTACION TUE, GRUPO_RADIO GPR, CONCESIONARIO CON, BANDA BAN
    </sql>
    
    <select id="buscarEstacionProgramacion"
    	parameterType="map"
        resultMap="estacionMap">
    	SELECT
    		<include refid="searchColumns"/>
		FROM
			<include refid="searchTableName"/>
		WHERE 1=1
        AND ETN.FOLIO_ELECTRONICO = CRD.FOLIO_ELECTRONICO
		AND CRD.ID_ESTADO = EST.ID_ESTADO
		AND CRD.ID_POBLACION = POB.ID_POBLACION
		AND EST.ID_ESTADO = POB.ID_ESTADO
		AND TUE.ID_TIPO_USO_ESTACION = ETN.ID_TIPO_USO_ESTACION
		AND GPR.FOLIO_ELECTRONICO = ETN.FOLIO_ELECTRONICO
		AND CON.ID_CONCESIONARIO = GPR.ID_CONCESIONARIO
		AND BAN.ID_BANDA = ETN.ID_BANDA
		<if test="distintivo != null">
			AND ETN.DISTINTIVO = #{distintivo, jdbcType=VARCHAR}
		</if>
		<if test="idConcesionario != null">
			AND CON.ID_CONCESIONARIO = #{idConcesionario, jdbcType=INTEGER}
		</if>
		<if test="canalProg != null">
			AND ETN.FRECUENCIA = #{canalProg, jdbcType=INTEGER}
		</if>
    </select>
       
</mapper>
